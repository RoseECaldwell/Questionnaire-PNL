<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test des m√©taprogrammes, d√©couvrez votre profil amoureux et ses compatibilit√©s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Poppins:400,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0d1f1f;
      --card-dark: #162828;
      --button-dark: #222;
      --button-gradient: linear-gradient(90deg,#ff70a6,#36e3e4 60%,#7cf47c 100%);
      --glow: 0 0 6px 2px #36e3e480, 0 0 18px 4px #ff70a680;
      --progress-gradient: linear-gradient(90deg, #ff70a6, #ffe17b 50%, #7cf47c 100%);
      --heart-gradient: linear-gradient(135deg, #1d2c7a 0%, #36e3e4 55%, #ff70a6 100%);
    }
    html, body {
      min-height: 100%;
      background: var(--bg-dark);
      color: #fff;
      font-family: 'Montserrat', 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      justify-content: flex-start;
      align-items: center;
      background: var(--bg-dark);
    }
    .container {
      width: 100%;
      max-width: 480px;
      margin: 32px auto 0 auto;
      padding: 0 14px 80px 14px;
      position: relative;
    }
    .header-flex {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 0.7em;
    }
    h1 {
      font-size: 1.45rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 0.1em;
      margin-top: 0.4em;
      letter-spacing: -0.01em;
      line-height: 1.3;
      flex: 1 1 auto;
    }
    .heart {
      width: 70px;
      height: 66px;
      margin: 0;
      display: block;
      position: relative;
      z-index: 1;
      flex: 0 0 auto;
    }
    .heart svg {
      width: 100%;
      height: 100%;
      display: block;
    }
    .inspiration {
      font-size: 1.07rem;
      line-height: 1.5;
      text-align: center;
      color: #ffe17bcc;
      margin-bottom: 1.7em;
      font-style: italic;
      transition: opacity 0.2s;
    }
    .inspiration.hide {
      opacity: 0;
      pointer-events: none;
      height: 0;
      margin-bottom: 0;
      padding: 0;
    }
    .question-card {
      background: var(--card-dark);
      border-radius: 18px;
      box-shadow: 0 4px 24px #000c  ;
      padding: 34px 22px 28px 22px;
      margin-bottom: 2em;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      opacity: 1;
      transition: opacity 0.3s;
    }
    .question-fade {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .question-number {
      font-size: 1.1rem;
      font-weight: 700;
      color: #ffe17b;
      margin-bottom: 6px;
      letter-spacing: 0.01em;
    }
    .question-text {
      font-size: 1.12rem;
      font-weight: 500;
      text-align: center;
      color: #fff;
      margin-bottom: 30px;
      margin-top: 0;
    }
    .answers {
      display: flex;
      flex-direction: column;
      gap: 16px;
      width: 100%;
      margin-bottom: 0.5em;
      align-items: center;
    }
    .answer-btn {
      width: 95%;
      max-width: 340px;
      padding: 14px 0;
      background: #191f2a;
      border: 2px solid #2b3b3d;
      color: #fff;
      border-radius: 100px;
      font-size: 1.07rem;
      font-family: inherit;
      font-weight: 600;
      cursor: pointer;
      margin: 0 auto;
      outline: none;
      transition: background 0.23s, box-shadow 0.23s, border-color 0.18s, color 0.18s;
      box-shadow: 0 2px 10px #1116;
      position: relative;
      letter-spacing: 0.03em;
    }
    .answer-btn.selected, .answer-btn:active {
      background: var(--button-gradient);
      color: #0d1f1f;
      border: 2px solid #ffe17b;
      box-shadow: 0 0 0 2px #fff3, 0 0 10px 4px #ffe17b33;
    }
    .answer-btn:hover:not(.selected) {
      background: #2d3c43;
      color: #ffe17b;
      border-color: #36e3e4;
      box-shadow: var(--glow);
    }
    .alert {
      display: none;
      color: #ff70a6;
      background: #fff1;
      border-radius: 8px;
      font-size: 1.06rem;
      margin: 12px 0 0 0;
      padding: 8px 12px;
      text-align: center;
    }
    .show-alert {
      display: block;
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .next-btn {
      display: block;
      margin: 28px auto 0 auto;
      padding: 12px 40px;
      background: var(--button-dark);
      border: none;
      border-radius: 100px;
      color: #fff;
      font-size: 1.13rem;
      font-family: inherit;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 18px 0 #36e3e4a0, 0 0 18px 2px #ff70a6a0;
      letter-spacing: 0.05em;
      text-shadow: 0 0 8px #ff70a6, 0 0 10px #36e3e4;
      background-image: var(--button-gradient);
      background-size: 220% 100%;
      background-position: left center;
      transition: background-position 0.3s, box-shadow 0.23s;
    }
    .next-btn:hover, .next-btn:focus {
      background-position: right center;
      box-shadow: 0 0 24px 2px #7cf47c99, 0 0 24px 6px #ffe17b66;
      outline: none;
    }
    .progress-bar-bg {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100vw;
      height: 7px;
      background: #1a3434;
      z-index: 10;
    }
    .progress-bar {
      height: 100%;
      width: 0;
      background: var(--progress-gradient);
      border-radius: 0 12px 12px 0;
      transition: width 0.4s cubic-bezier(.8,.1,.2,1);
    }
    .result-block {
      background: var(--card-dark);
      border-radius: 16px;
      box-shadow: 0 4px 24px #000c;
      padding: 30px 20px 24px 20px;
      margin: 36px 0 28px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeIn 0.7s;
      position: relative;
    }
    .email-label {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: #ffe17b;
      font-weight: 600;
      text-align: center;
      letter-spacing: 0.01em;
    }
    .email-input, .consent-checkbox {
      margin: 10px 0 18px 0;
      width: 96%;
      max-width: 340px;
      padding: 12px;
      border-radius: 6px;
      border: 1.5px solid #36e3e4;
      font-size: 1.07rem;
      font-family: inherit;
      background: #181f20;
      color: #fff;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.2s;
    }
    .email-input:focus {
      border-color: #ff70a6;
    }
    .consent-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 1.01rem;
      color: #fff;
    }
    .consent-checkbox {
      width: 20px;
      height: 20px;
      margin: 0 7px 0 0;
      accent-color: #ff70a6;
      cursor: pointer;
    }
    .submit-btn {
      margin: 20px auto 0 auto;
      padding: 13px 44px;
      background: var(--button-dark);
      border: none;
      border-radius: 100px;
      color: #fff;
      font-size: 1.13rem;
      font-family: inherit;
      font-weight: 700;
      cursor: pointer;
      box-shadow: var(--glow);
      letter-spacing: 0.05em;
      text-shadow: 0 0 8px #ff70a6, 0 0 10px #36e3e4;
      background-image: var(--button-gradient);
      background-size: 220% 100%;
      background-position: left center;
      transition: background-position 0.3s, box-shadow 0.23s;
      display: block;
      position: relative;
    }
    .submit-btn[disabled] {
      opacity: 0.6;
      pointer-events: none;
    }
    .submit-spinner {
      border: 2.5px solid #7cf47c;
      border-top: 2.5px solid #ffe17b;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 1s linear infinite;
      display: inline-block;
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 2;
    }
    @keyframes spin {
      0% { transform: translateY(-50%) rotate(0deg);}
      100% { transform: translateY(-50%) rotate(360deg);}
    }
    .email-duplicate-msg {
      color: #ffe17b;
      background: #ff70a61c;
      border-radius: 7px;
      font-size: 1.06rem;
      margin: 14px 0 0 0;
      padding: 7px 10px;
      text-align: center;
      display: none;
      animation: fadeIn 0.5s;
    }
    .success-msg {
      color: #7cf47c;
      background: #36e3e41a;
      border-radius: 7px;
      font-size: 1.15rem;
      margin: 28px 0 0 0;
      padding: 14px 16px;
      text-align: center;
      display: none;
      animation: fadeIn 0.7s;
    }
    .error-msg {
      color: #ff70a6;
      background: #fff1;
      border-radius: 7px;
      font-size: 1.06rem;
      margin: 18px 0 0 0;
      padding: 8px 12px;
      text-align: center;
      display: block;
      animation: fadeIn 0.5s;
    }
    @media (max-width: 600px) {
      .container { max-width: 100vw; padding: 0 2vw 80px 2vw;}
      .question-card, .result-block { padding: 18px 5vw 18px 5vw;}
      .header-flex { gap: 10px;}
      .heart { width: 46px; height: 44px;}
      h1 { font-size: 1.03rem; }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Header flex: Heart + Title -->
    <div class="header-flex">
      <div class="heart">
        <svg viewBox="0 0 60 54" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="heartGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#1d2c7a"/>
              <stop offset="55%" stop-color="#36e3e4"/>
              <stop offset="100%" stop-color="#ff70a6"/>
            </linearGradient>
          </defs>
          <path fill="url(#heartGradient)" d="M30 50.8l-2.9-2.6C12 35 2 26.6 2 16.5 2 8.5 8.47 2 16.5 2 21.2 2 25.7 4.7 28 8.7 30.3 4.7 34.8 2 39.5 2 47.5 2 54 8.5 54 16.5c0 10.1-10 18.5-25.1 31.7L30 50.8z"/>
        </svg>
      </div>
      <h1>Test des m√©taprogrammes, d√©couvrez votre profil amoureux et ses compatibilit√©s</h1>
    </div>

    <div class="inspiration" id="inspiration-text">R√©pondez spontan√©ment, il n‚Äôy a pas de bonne ou mauvaise r√©ponse.</div>

    <!-- Question Card -->
    <div id="question-card" class="question-card">
      <div class="question-number" id="question-number">1.</div>
      <div class="question-text" id="question-text">
      </div>
      <div class="answers">
        <button class="answer-btn" data-value="0" id="answer-jamais">Jamais</button>
        <button class="answer-btn" data-value="25" id="answer-rarement">Rarement</button>
        <button class="answer-btn" data-value="75" id="answer-souvent">Souvent</button>
        <button class="answer-btn" data-value="100" id="answer-toujours">Toujours</button>
      </div>
      <div class="alert" id="alert">üí° Merci de r√©pondre √† la question pour continuer, cela rendra votre profil plus pr√©cis ‚ù§Ô∏è</div>
      <button class="next-btn" id="next-btn">Suivant</button>
    </div>

    <!-- Email & Result Block -->
    <form id="result-block" class="result-block" style="display:none;" autocomplete="off">
      <label for="email" class="email-label">Recevez votre analyse personnalis√©e par e-mail :</label>
      <input id="email" type="email" class="email-input" name="email" placeholder="Votre adresse e-mail" required autocomplete="email" />
      <div id="email-duplicate-msg" class="email-duplicate-msg"></div>
      <div class="consent-row">
        <input type="checkbox" id="consent" name="consent" class="consent-checkbox" required />
        <label for="consent" style="margin:0;line-height:1.2;">
          Oui, je souhaite recevoir mon analyse par e-mail et rester inform√©(e) des nouveaut√©s MetaLove, y compris des bonus exclusifs et des prochains livres √† para√Ætre.
        </label>
      </div>
      <button type="submit" class="submit-btn" id="submit-btn">Envoyer</button>
      <span id="submit-spinner" class="submit-spinner" style="display:none;"></span>
      <div id="error-msg" class="error-msg" style="display:none;"></div>
      <div id="success-msg" class="success-msg"></div>
    </form>
  </div>

  <div class="progress-bar-bg"><div id="progress-bar" class="progress-bar"></div></div>

  <script>
    // --- DATASETS (same as before, see previous code for full arrays) ---
    const questionsRaw = [
      ["Visuel","Vous souvenez-vous plus facilement des visages que des noms ?"],
      ["Kinesth√©sique","√âvitez-vous certains v√™tements, m√™me beaux, s‚Äôils sont trop serr√©s ou inconfortables ?"],
      ["Option","Aimez-vous avoir plusieurs mani√®res possibles d‚Äôaborder une m√™me t√¢che ?"]
    ];
    const panToMeta = {
      "Visuel": "VAKOG", "Auditif": "VAKOG", "Kinesth√©sique": "VAKOG", "Olfactif": "VAKOG", "Gustatif": "VAKOG",
      "Proc√©dure": "Proc√©dure/Option", "Option": "Proc√©dure/Option",
      "Proactif": "Proactif/R√©actif", "R√©actif": "Proactif/R√©actif",
      "Pass√©": "Rapport au temps", "Pr√©sent": "Rapport au temps", "Futur": "Rapport au temps",
      "Pouvoir": "Motivation", "Objectif": "Motivation", "Affiliation": "Motivation",
      "Tourn√© vers soi": "Orientation", "Tourn√© vers les autres": "Orientation",
      "Introverti": "√ânergie", "Extraverti": "√ânergie",
      "D√©tail": "Focus", "Global": "Focus"
    };
    const metaprogrammePans = {
      "Proc√©dure/Option":["Proc√©dure","Option"],
      "Motivation":["Pouvoir","Objectif","Affiliation"],
      "√ânergie":["Introverti","Extraverti"],
      "Proactif/R√©actif": ["Proactif","R√©actif"],
      "Rapport au temps": ["Pass√©","Pr√©sent","Futur"],
      "Orientation": ["Tourn√© vers soi","Tourn√© vers les autres"],
      "VAKOG": ["Visuel","Auditif","Kinesth√©sique","Olfactif","Gustatif"],
      "Focus": ["D√©tail","Global"]
    };
    const exampleSegments = [
      "¬´ Votre profil amoureux r√©v√®le une √©nergie singuli√®re. Si la Motivation Pouvoir domine, vous √™tes attir√©(e) par l‚Äôinfluence et l‚Äôaffirmation de soi, ce qui peut s√©duire mais aussi g√©n√©rer des tensions si votre partenaire partage la m√™me intensit√©. L‚Äô√©quilibre na√Æt lorsque Pouvoir rencontre Objectif ou Affiliation, car l‚Äôun apporte direction et l‚Äôautre connexion. Un Objectif dominant offre clart√© et progression, id√©alement compl√©t√© par une Affiliation chaleureuse qui renforce la complicit√©. ¬ª",
      "¬´ Votre dynamique Proactif / R√©actif fa√ßonne votre rythme amoureux. Deux Proactifs cr√©ent une relation passionn√©e et stimulante, mais peuvent parfois foncer t√™te baiss√©e. Deux R√©actifs privil√©gient la s√©curit√© et la stabilit√©, au risque de manquer d‚Äô√©lan. La combinaison des deux offre souvent le meilleur √©quilibre : l‚Äôun initie, l‚Äôautre temp√®re. Votre couple trouve ainsi une cadence naturelle entre action et r√©flexion, gage de long√©vit√© et d‚Äôharmonie. ¬ª",
      "¬´ Le duo Proc√©dure / Option refl√®te votre rapport aux r√®gles et √† la cr√©ativit√©. Deux profils Proc√©dure partagent une rigueur rassurante, mais peuvent s‚Äôenfermer dans la routine. Deux Option vivent l‚Äôinstant, cultivant la libert√©, mais risquent l‚Äôinstabilit√©. Un couple mixte allie solidit√© et spontan√©it√©, permettant d‚Äô√©voluer dans un cadre souple. Si vous √™tes majoritairement Option, cherchez un(e) partenaire qui saura canaliser vos √©lans sans brider votre inspiration. ¬ª",
      "¬´ Enfin, votre rapport au Temps et √† l‚Äô√ânergie influence la compatibilit√©. Deux Pr√©sents vivent une intensit√© gris√©e, mais peuvent manquer de projection. Le Pass√© s‚Äôattache aux racines, le Futur b√¢tit des projets : ces visions diff√©rentes n√©cessitent dialogue pour s‚Äôharmoniser. C√¥t√© √ânergie, deux Introvertis s‚Äôaccordent dans une bulle intime, deux Extravertis partagent une complicit√© vive. Les √©carts trop marqu√©s (60%+ Introverti vs 60%+ Extraverti) exigent plus d‚Äôefforts de compr√©hension. ¬ª"
    ];

    let currentQ = 0;
    let answers = [];
    let selected = null;

    function shuffleArray(arr) {
      let a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    const questions = shuffleArray(questionsRaw);

    const qCard = document.getElementById('question-card');
    const qNumber = document.getElementById('question-number');
    const qText = document.getElementById('question-text');
    const answerBtns = Array.from(document.getElementsByClassName('answer-btn'));
    const nextBtn = document.getElementById('next-btn');
    const alertBox = document.getElementById('alert');
    const progressBar = document.getElementById('progress-bar');
    const inspiration = document.getElementById('inspiration-text');

    const resultBlock = document.getElementById('result-block');
    const emailInput = document.getElementById('email');
    const consentBox = document.getElementById('consent');
    const emailDupMsg = document.getElementById('email-duplicate-msg');
    const successMsg = document.getElementById('success-msg');
    const errorMsg = document.getElementById('error-msg');
    const submitBtn = document.getElementById('submit-btn');
    const submitSpinner = document.getElementById('submit-spinner');

    let isSubmitting = false;

    function showQuestion(idx) {
      qCard.classList.add('question-fade');
      setTimeout(()=>{
        qNumber.textContent = (idx+1) + ".";
        qText.textContent = questions[idx][1];
        answerBtns.forEach(btn => btn.classList.remove('selected'));
        selected = null;
        alertBox.classList.remove('show-alert');
        qCard.classList.remove('question-fade');
        progressBar.style.width = ((idx/105)*100).toFixed(2) + "%";
      }, 210);
    }

    answerBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        answerBtns.forEach(b=>b.classList.remove('selected'));
        this.classList.add('selected');
        selected = parseInt(this.dataset.value);
        alertBox.classList.remove('show-alert');
      });
    });

    nextBtn.addEventListener('click', function() {
      if(selected === null){
        alertBox.classList.add('show-alert');
        return;
      }
      answers[currentQ] = { pan: questions[currentQ][0], value: selected };
      currentQ++;
      if(currentQ < questions.length){
        showQuestion(currentQ);
      }else{
        qCard.classList.add('question-fade');
        setTimeout(()=>{
          qCard.style.display = 'none';
          resultBlock.style.display = 'flex';
          progressBar.style.width = "100%";
          if (inspiration) inspiration.classList.add('hide');
          window.scrollTo({top:0,behavior:'smooth'});
        },300);
      }
    });

    showQuestion(0);

    function computeResults() {
      const panTotals = {};
      const panCounts = {};
      answers.forEach(({pan,value})=>{
        panTotals[pan] = (panTotals[pan]||0) + value;
        panCounts[pan] = (panCounts[pan]||0) + 1;
      });
      const metaScores = {};
      Object.keys(metaprogrammePans).forEach(meta=>{
        const pans = metaprogrammePans[meta];
        let total = 0;
        let panRaw = pans.map(p=>panTotals[p]||0);
        total = panRaw.reduce((a,b)=>a+b,0);
        metaScores[meta] = {};
        pans.forEach((p,i)=>{
          let norm = total>0 ? Math.round(100*panRaw[i]/total) : 0;
          metaScores[meta][p] = norm;
        });
      });
      return metaScores;
    }
    function buildInterpretationSegments(scores, partIdx){
      return exampleSegments[partIdx];
    }
    function buildPayload(email) {
      const scores = computeResults();
      return {
        bonus_id: "tome1",
        response: "no-captcha",
        email,
        "procedure_score": scores["Proc√©dure/Option"]["Proc√©dure"],
        "option_score": scores["Proc√©dure/Option"]["Option"],
        "pouvoir_score": scores["Motivation"]["Pouvoir"],
        "objectif_score": scores["Motivation"]["Objectif"],
        "affiliation_score": scores["Motivation"]["Affiliation"],
        "introverti_score": scores["√ânergie"]["Introverti"],
        "extraverti_score": scores["√ânergie"]["Extraverti"],
        "proactif_score": scores["Proactif/R√©actif"]["Proactif"],
        "reactif_score": scores["Proactif/R√©actif"]["R√©actif"],
        "passe_score": scores["Rapport au temps"]["Pass√©"],
        "present_score": scores["Rapport au temps"]["Pr√©sent"],
        "futur_score": scores["Rapport au temps"]["Futur"],
        "vers_soi_score": scores["Orientation"]["Tourn√© vers soi"],
        "vers_autres_score": scores["Orientation"]["Tourn√© vers les autres"],
        "visuel_score": scores["VAKOG"]["Visuel"],
        "auditif_score": scores["VAKOG"]["Auditif"],
        "kinesthesique_score": scores["VAKOG"]["Kinesth√©sique"],
        "olfactif_score": scores["VAKOG"]["Olfactif"],
        "gustatif_score": scores["VAKOG"]["Gustatif"],
        "detail_score": scores["Focus"]["D√©tail"],
        "global_score": scores["Focus"]["Global"],
        "segments_part1": buildInterpretationSegments(scores,0),
        "segments_part2": buildInterpretationSegments(scores,1),
        "segments_part3": buildInterpretationSegments(scores,2),
        "segments_part4": buildInterpretationSegments(scores,3)
      };
    }

    function validateEmail(email) {
      // Simple RFC5322 version
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    async function submitFormHandler(e) {
      e.preventDefault();
      if (isSubmitting) return;

      emailDupMsg.style.display = 'none';
      successMsg.style.display = 'none';
      errorMsg.style.display = 'none';
      errorMsg.textContent = '';

      const email = emailInput.value.trim();
      const consent = consentBox.checked;

      if(!email){
        errorMsg.textContent = "Merci d'indiquer votre adresse e-mail.";
        errorMsg.style.display = 'block';
        emailInput.focus();
        return;
      }
      if(!validateEmail(email)){
        errorMsg.textContent = "Merci d'indiquer une adresse e-mail valide.";
        errorMsg.style.display = 'block';
        emailInput.focus();
        return;
      }
      if(!consent){
        errorMsg.textContent = "Merci de cocher la case de consentement.";
        errorMsg.style.display = 'block';
        consentBox.focus();
        return;
      }

      isSubmitting = true;
      submitBtn.disabled = true;
      submitSpinner.style.display = 'inline-block';

      const payload = buildPayload(email);

      console.log("[Form] Submission started. Payload:", payload);

      let timeoutId;
      try {
        const controller = new AbortController();
        timeoutId = setTimeout(() => controller.abort(), 15000);

        const response = await fetch("https://hook.eu2.make.com/tijjob8xra3pn28g9wqabsfp684jg3dy", {
          method:"POST",
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload),
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        const responseText = await response.text();
        console.log("[Form] Raw response:", responseText);

        if(responseText.includes("duplicate")){
          emailDupMsg.textContent = "‚ö†Ô∏è Cette adresse e-mail a d√©j√† servi pour un test üí°. Merci d‚Äôen indiquer une autre afin de recevoir une nouvelle interpr√©tation.";
          emailDupMsg.style.display = 'block';
        } else if(responseText.includes("captcha_failed")){
          errorMsg.textContent = "Captcha invalide. Merci de r√©essayer.";
          errorMsg.style.display = 'block';
          alert("Captcha invalide. Merci de r√©essayer.");
        } else {
          Array.from(resultBlock.querySelectorAll('input,button')).forEach(el=>el.style.display='none');
          successMsg.textContent = "Merci ‚ù§Ô∏è Votre analyse personnalis√©e a √©t√© envoy√©e √† " + email + ".";
          successMsg.style.display = 'block';
          setTimeout(() => {
            resultBlock.reset && resultBlock.reset();
            isSubmitting = false;
          }, 500);
        }
      } catch(fetchErr) {
        clearTimeout(timeoutId);
        if (fetchErr.name === "AbortError") {
          errorMsg.textContent = "Le serveur ne r√©pond pas. Merci de r√©essayer dans quelques instants.";
        } else {
          errorMsg.textContent = "Erreur r√©seau. Veuillez r√©essayer dans quelques instants.";
        }
        errorMsg.style.display = 'block';
        console.error("[Form] Fetch/network error:", fetchErr);
      } finally {
        isSubmitting = false;
        submitBtn.disabled = false;
        submitSpinner.style.display = 'none';
      }
    }

    resultBlock.addEventListener('submit', submitFormHandler);

    document.addEventListener('keydown', function(e){
      if(qCard.style.display!=='none' && (e.key==="Enter" || e.keyCode===13)){
        if(selected!==null){
          nextBtn.click();
          e.preventDefault();
        }
      }
    });

    emailInput.addEventListener('keydown', function(e){
      if(e.key === "Enter") e.preventDefault();
    });
    emailInput.addEventListener('input',()=>{emailDupMsg.style.display='none';});

    window.addEventListener('pageshow', function(){
      resultBlock.style.display = 'none';
      qCard.style.display = '';
      currentQ = 0;
      answers = [];
      showQuestion(0);
      progressBar.style.width = "0%";
      if (inspiration) inspiration.classList.remove('hide');
    });

    window.addEventListener('DOMContentLoaded', function() {
      submitSpinner.style.display = 'none';
      errorMsg.style.display = 'none';
      isSubmitting = false;
      submitBtn.disabled = false;
    });
  </script>
</body>
</html>
