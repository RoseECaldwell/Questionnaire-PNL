<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test des m√©taprogrammes, d√©couvrez votre profil amoureux et ses compatibilit√©s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Poppins:400,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0d1f1f;
      --card-dark: #162828;
      --button-dark: #222;
      --button-gradient: linear-gradient(90deg,#ff70a6,#36e3e4 60%,#7cf47c 100%);
      --glow: 0 0 6px 2px #36e3e480, 0 0 18px 4px #ff70a680;
      --progress-gradient: linear-gradient(90deg, #ff70a6, #ffe17b 50%, #7cf47c 100%);
      --heart-gradient: linear-gradient(135deg, #1d2c7a 0%, #36e3e4 55%, #ff70a6 100%);
    }
    html, body {
      min-height: 100%;
      background: var(--bg-dark);
      color: #fff;
      font-family: 'Montserrat', 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      justify-content: flex-start;
      align-items: center;
      background: var(--bg-dark);
    }
    .container {
      width: 100%;
      max-width: 480px;
      margin: 32px auto 0 auto;
      padding: 0 14px 80px 14px;
      position: relative;
    }
    .header-flex {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 0.7em;
    }
    h1 {
      font-size: 1.45rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 0.1em;
      margin-top: 0.4em;
      letter-spacing: -0.01em;
      line-height: 1.3;
      flex: 1 1 auto;
    }
    .heart {
      width: 70px;
      height: 66px;
      margin: 0;
      display: block;
      position: relative;
      z-index: 1;
      flex: 0 0 auto;
    }
    .heart svg {
      width: 100%;
      height: 100%;
      display: block;
    }
    .inspiration {
      font-size: 1.07rem;
      line-height: 1.5;
      text-align: center;
      color: #ffe17bcc;
      margin-bottom: 1.7em;
      font-style: italic;
    }
    .question-card {
      background: var(--card-dark);
      border-radius: 18px;
      box-shadow: 0 4px 24px #000c  ;
      padding: 34px 22px 28px 22px;
      margin-bottom: 2em;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      opacity: 1;
      transition: opacity 0.3s;
    }
    .question-fade {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .question-number {
      font-size: 1.1rem;
      font-weight: 700;
      color: #ffe17b;
      margin-bottom: 6px;
      letter-spacing: 0.01em;
    }
    .question-text {
      font-size: 1.12rem;
      font-weight: 500;
      text-align: center;
      color: #fff;
      margin-bottom: 30px;
      margin-top: 0;
    }
    .answers {
      display: flex;
      flex-direction: column;
      gap: 16px;
      width: 100%;
      margin-bottom: 0.5em;
      align-items: center;
    }
    .answer-btn {
      width: 95%;
      max-width: 340px;
      padding: 14px 0;
      background: #191f2a;
      border: 2px solid #2b3b3d;
      color: #fff;
      border-radius: 100px;
      font-size: 1.07rem;
      font-family: inherit;
      font-weight: 600;
      cursor: pointer;
      margin: 0 auto;
      outline: none;
      transition: background 0.23s, box-shadow 0.23s, border-color 0.18s, color 0.18s;
      box-shadow: 0 2px 10px #1116;
      position: relative;
      letter-spacing: 0.03em;
    }
    .answer-btn.selected, .answer-btn:active {
      background: var(--button-gradient);
      color: #0d1f1f;
      border: 2px solid #ffe17b;
      box-shadow: 0 0 0 2px #fff3, 0 0 10px 4px #ffe17b33;
    }
    .answer-btn:hover:not(.selected) {
      background: #2d3c43;
      color: #ffe17b;
      border-color: #36e3e4;
      box-shadow: var(--glow);
    }
    .alert {
      display: none;
      color: #ff70a6;
      background: #fff1;
      border-radius: 8px;
      font-size: 1.06rem;
      margin: 12px 0 0 0;
      padding: 8px 12px;
      text-align: center;
    }
    .show-alert {
      display: block;
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .next-btn {
      display: block;
      margin: 28px auto 0 auto;
      padding: 12px 40px;
      background: var(--button-dark);
      border: none;
      border-radius: 100px;
      color: #fff;
      font-size: 1.13rem;
      font-family: inherit;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 18px 0 #36e3e4a0, 0 0 18px 2px #ff70a6a0;
      letter-spacing: 0.05em;
      text-shadow: 0 0 8px #ff70a6, 0 0 10px #36e3e4;
      background-image: var(--button-gradient);
      background-size: 220% 100%;
      background-position: left center;
      transition: background-position 0.3s, box-shadow 0.23s;
    }
    .next-btn:hover, .next-btn:focus {
      background-position: right center;
      box-shadow: 0 0 24px 2px #7cf47c99, 0 0 24px 6px #ffe17b66;
      outline: none;
    }
    .progress-bar-bg {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100vw;
      height: 7px;
      background: #1a3434;
      z-index: 10;
    }
    .progress-bar {
      height: 100%;
      width: 0;
      background: var(--progress-gradient);
      border-radius: 0 12px 12px 0;
      transition: width 0.4s cubic-bezier(.8,.1,.2,1);
    }
    /* Email block */
    .result-block {
      background: var(--card-dark);
      border-radius: 16px;
      box-shadow: 0 4px 24px #000c;
      padding: 30px 20px 24px 20px;
      margin: 36px 0 28px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeIn 0.7s;
    }
    .email-label {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: #ffe17b;
      font-weight: 600;
      text-align: center;
      letter-spacing: 0.01em;
    }
    .email-input, .consent-checkbox {
      margin: 10px 0 18px 0;
      width: 96%;
      max-width: 340px;
      padding: 12px;
      border-radius: 6px;
      border: 1.5px solid #36e3e4;
      font-size: 1.07rem;
      font-family: inherit;
      background: #181f20;
      color: #fff;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.2s;
    }
    .email-input:focus {
      border-color: #ff70a6;
    }
    .consent-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 1.01rem;
      color: #fff;
    }
    .consent-checkbox {
      width: 20px;
      height: 20px;
      margin: 0 7px 0 0;
      accent-color: #ff70a6;
      cursor: pointer;
    }
    .submit-btn {
      margin: 20px auto 0 auto;
      padding: 13px 44px;
      background: var(--button-dark);
      border: none;
      border-radius: 100px;
      color: #fff;
      font-size: 1.13rem;
      font-family: inherit;
      font-weight: 700;
      cursor: pointer;
      box-shadow: var(--glow);
      letter-spacing: 0.05em;
      text-shadow: 0 0 8px #ff70a6, 0 0 10px #36e3e4;
      background-image: var(--button-gradient);
      background-size: 220% 100%;
      background-position: left center;
      transition: background-position 0.3s, box-shadow 0.23s;
      display: block;
    }
    .submit-btn:hover, .submit-btn:focus {
      background-position: right center;
      box-shadow: 0 0 24px 2px #7cf47c99, 0 0 24px 6px #ffe17b66;
      outline: none;
    }
    .email-duplicate-msg {
      color: #ffe17b;
      background: #ff70a61c;
      border-radius: 7px;
      font-size: 1.06rem;
      margin: 14px 0 0 0;
      padding: 7px 10px;
      text-align: center;
      display: none;
      animation: fadeIn 0.5s;
    }
    .success-msg {
      color: #7cf47c;
      background: #36e3e41a;
      border-radius: 7px;
      font-size: 1.15rem;
      margin: 28px 0 0 0;
      padding: 14px 16px;
      text-align: center;
      display: none;
      animation: fadeIn 0.7s;
    }
    .g-recaptcha {
      margin: 18px auto 14px auto;
      display: flex;
      justify-content: center;
    }
    @media (max-width: 600px) {
      .container { max-width: 100vw; padding: 0 2vw 80px 2vw;}
      .question-card, .result-block { padding: 18px 5vw 18px 5vw;}
      .header-flex { gap: 10px;}
      .heart { width: 46px; height: 44px;}
      h1 { font-size: 1.03rem; }
    }
  </style>
  <!-- Google reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <div class="container">

    <!-- Header flex: Heart + Title -->
    <div class="header-flex">
      <div class="heart">
        <svg viewBox="0 0 60 54" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="heartGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#1d2c7a"/>
              <stop offset="55%" stop-color="#36e3e4"/>
              <stop offset="100%" stop-color="#ff70a6"/>
            </linearGradient>
          </defs>
          <path fill="url(#heartGradient)" d="M30 50.8l-2.9-2.6C12 35 2 26.6 2 16.5 2 8.5 8.47 2 16.5 2 21.2 2 25.7 4.7 28 8.7 30.3 4.7 34.8 2 39.5 2 47.5 2 54 8.5 54 16.5c0 10.1-10 18.5-25.1 31.7L30 50.8z"/>
        </svg>
      </div>
      <h1>Test des m√©taprogrammes, d√©couvrez votre profil amoureux et ses compatibilit√©s</h1>
    </div>

    <div class="inspiration">R√©pondez spontan√©ment, il n‚Äôy a pas de bonne ou mauvaise r√©ponse.</div>

    <!-- Question Card -->
    <div id="question-card" class="question-card">
      <div class="question-number" id="question-number">1.</div>
      <div class="question-text" id="question-text">
        <!-- Question text here -->
      </div>
      <div class="answers">
        <button class="answer-btn" data-value="0" id="answer-jamais">Jamais</button>
        <button class="answer-btn" data-value="25" id="answer-rarement">Rarement</button>
        <button class="answer-btn" data-value="75" id="answer-souvent">Souvent</button>
        <button class="answer-btn" data-value="100" id="answer-toujours">Toujours</button>
      </div>
      <div class="alert" id="alert">üí° Merci de r√©pondre √† la question pour continuer, cela rendra votre profil plus pr√©cis ‚ù§Ô∏è</div>
      <button class="next-btn" id="next-btn">Suivant</button>
    </div>

    <!-- Email & Result Block -->
    <form id="result-block" class="result-block" style="display:none;" autocomplete="off">
      <label for="email" class="email-label">Recevez votre analyse personnalis√©e par e-mail :</label>
      <input id="email" type="email" class="email-input" name="email" placeholder="Votre adresse e-mail" required autocomplete="email" />
      <div id="email-duplicate-msg" class="email-duplicate-msg"></div>
      <div class="consent-row">
        <input type="checkbox" id="consent" name="consent" class="consent-checkbox" required />
        <label for="consent" style="margin:0;line-height:1.2;">
          Oui, je souhaite recevoir mon analyse par e-mail et rester inform√©(e) des nouveaut√©s MetaLove, y compris des bonus exclusifs et des prochains livres √† para√Ætre.
        </label>
      </div>
      <div class="g-recaptcha" data-sitekey="6Lflyc4rAAAAAMOncHSIV9Y4IW3SF6m-QLZMMxAh" data-callback="onSubmit"></div>
      <button type="submit" class="submit-btn">Envoyer</button>
      <div id="success-msg" class="success-msg"></div>
    </form>
  </div>

  <div class="progress-bar-bg"><div id="progress-bar" class="progress-bar"></div></div>

  <script>
    // --- DATASETS ---
    // Questions: [pan, questionText]
    const questionsRaw = [
      // VAKOG
      ["Visuel","Vous souvenez-vous plus facilement des visages que des noms ?"],
      ["Visuel","Aimez-vous organiser votre espace de travail de fa√ßon esth√©tique et harmonieuse ?"],
      ["Visuel","Choisissez-vous vos v√™tements principalement en fonction de leur apparence visuelle ?"],
      ["Visuel","Lorsqu'on vous explique quelque chose, pr√©f√©rez-vous voir un sch√©ma ou un dessin √† la place ?"],
      ["Visuel","Avez-vous tendance √† visualiser mentalement vos projets ou vos id√©es ?"],
      ["Auditif","Lorsque vous entendez une voix famili√®re, la reconnaissez-vous rapidement, m√™me sans voir la personne ?"],
      ["Auditif","Entendez-vous une voix int√©rieure qui accompagne votre lecture, comme si vous vous racontiez l‚Äôhistoire √† vous-m√™me ?"],
      ["Auditif","Lorsqu‚Äôon vous donne des consignes, les retenir √† l‚Äôoral vous est-il facile ?"],
      ["Auditif","Le bruit de fond vous g√™ne-t-il facilement pour vous concentrer ?"],
      ["Auditif","Avez-vous besoin de verbaliser vos id√©es √† haute voix pour les clarifier ?"],
      ["Kinesth√©sique","√ätes-vous particuli√®rement sensible √† la texture des v√™tements que vous portez ?"],
      ["Kinesth√©sique","Avez-vous du mal √† rester concentr√©(e) sans bouger, m√™me l√©g√®rement ?"],
      ["Kinesth√©sique","Apprenez-vous plus facilement en manipulant ou en exp√©rimentant directement ?"],
      ["Kinesth√©sique","Avez-vous besoin de ressentir physiquement un lieu pour savoir si vous vous y sentez bien ?"],
      ["Kinesth√©sique","√âvitez-vous certains v√™tements, m√™me beaux, s‚Äôils sont trop serr√©s ou inconfortables ?"],
      // Option/Proc√©dure
      ["Option","Aimez-vous avoir plusieurs mani√®res possibles d‚Äôaborder une m√™me t√¢che ?"],
      ["Option","Pr√©f√©rez-vous improviser plut√¥t que suivre une m√©thode fixe ?"],
      ["Option","Vous sentez-vous limit√©(e) lorsqu‚Äôon vous impose une seule fa√ßon de faire ?"],
      ["Option","Avez-vous tendance √† adapter les r√®gles plut√¥t qu‚Äô√† les suivre strictement ?"],
      ["Option","Appr√©ciez-vous les formations ouvertes plut√¥t que tr√®s structur√©es ?"],
      ["Proc√©dure","Avez-vous besoin de consignes claires avant de commencer une t√¢che ?"],
      ["Proc√©dure","Pr√©f√©rez-vous suivre une m√©thode pas √† pas plut√¥t que d‚Äôimproviser ?"],
      ["Proc√©dure","Est-ce que l‚Äôabsence de cadre vous d√©stabilise ?"],
      ["Proc√©dure","Aimez-vous quand les choses sont bien organis√©es et logiques ?"],
      ["Proc√©dure","Vous sentez-vous plus efficace avec un plan √©tabli √† l‚Äôavance ?"],
      // Proactif/R√©actif
      ["Proactif","Prenez-vous souvent les devants pour r√©soudre un probl√®me ?"],
      ["Proactif","Initiez-vous souvent les projets ou les discussions ?"],
      ["Proactif","Avez-vous tendance √† agir plut√¥t qu‚Äôattendre ?"],
      ["Proactif","√ätes-vous √† l‚Äôaise dans les situations qui demandent de la r√©activit√© ?"],
      ["Proactif","Cherchez-vous rapidement des solutions quand un obstacle survient ?"],
      ["R√©actif","Avez-vous besoin de prendre le temps de r√©fl√©chir avant d‚Äôagir ?"],
      ["R√©actif","Pr√©f√©rez-vous observer avant de vous lancer dans une nouvelle activit√© ?"],
      ["R√©actif","Avez-vous tendance √† r√©agir plut√¥t qu‚Äô√† initier ?"],
      ["R√©actif","Est-ce que vous vous sentez plus √† l‚Äôaise lorsqu‚Äôun cadre est d√©j√† pos√© ?"],
      ["R√©actif","L‚Äôattente d‚Äôun d√©clencheur ext√©rieur vous rassure-t-elle avant de commencer ?"],
      // Motivation
      ["Pouvoir","Souhaitez-vous influencer les d√©cisions dans un groupe ?"],
      ["Pouvoir","Vous sentez-vous motiv√©(e) par le fait d‚Äô√™tre reconnu(e) comme leader ?"],
      ["Pouvoir","Avez-vous besoin d‚Äôavoir le contr√¥le sur ce que vous entreprenez ?"],
      ["Pouvoir","Est-ce que relever des d√©fis vous stimule ?"],
      ["Pouvoir","Avez-vous tendance √† vouloir r√©aliser ce qu‚Äôon vous croit incapable de faire ?"],
      ["Objectif","Vous fixez-vous des buts clairs avant d‚Äôagir ?"],
      ["Objectif","Avez-vous besoin d‚Äôun r√©sultat concret pour vous sentir motiv√©(e) ?"],
      ["Objectif","Est-ce que la performance pour vous s‚Äô√©value par l‚Äôatteinte d‚Äôun r√©sultat plut√¥t que par ce que vous avez appris ?"],
      ["Objectif","Planifiez-vous vos actions avec une id√©e pr√©cise du r√©sultat attendu ?"],
      ["Objectif","Vous sentez-vous plus √† l‚Äôaise quand vous savez exactement o√π vous allez ?"],
      ["Affiliation","Est-il important pour vous d‚Äô√™tre bien int√©gr√©(e) dans un groupe ?"],
      ["Affiliation","Cherchez-vous √† cr√©er des liens avant tout dans un nouveau contexte ?"],
      ["Affiliation","Pr√©f√©rez-vous collaborer que r√©ussir seul(e) ?"],
      ["Affiliation","L‚Äôambiance dans une √©quipe est-elle plus importante que le salaire que vous gagnez ?"],
      ["Affiliation","Faites-vous attention √† ne pas blesser les autres dans vos choix ?"],
      // Rapport au temps
      ["Pass√©","Vous appuyez-vous sur vos exp√©riences pour prendre des d√©cisions ?"],
      ["Pass√©","Avez-vous tendance √† vous r√©f√©rer √† ce que vous connaissez d√©j√† ?"],
      ["Pass√©","Pr√©f√©rez-vous les traditions aux nouveaut√©s ?"],
      ["Pass√©","Revenez-vous souvent sur des √©v√©nements pass√©s pour comprendre le pr√©sent ?"],
      ["Pass√©","Est-ce que vos souvenirs guident souvent vos choix ?"],
      ["Pr√©sent","Vous concentrez-vous davantage sur ce que vous vivez ici et maintenant ?"],
      ["Pr√©sent","Avez-vous du mal √† faire des plans √† long terme ?"],
      ["Pr√©sent","Est-ce que vous agissez surtout en fonction de ce qui se passe aujourd‚Äôhui ?"],
      ["Pr√©sent","Vous sentez-vous guid√©(e) par vos ressentis du moment ?"],
      ["Pr√©sent","R√©agissez-vous davantage √† ce qui se passe tout de suite qu‚Äô√† ce qui pourrait arriver ?"],
      ["Futur","Faites-vous souvent des projets √† long terme ?"],
      ["Futur","Avez-vous besoin de visualiser l‚Äôavenir pour vous sentir motiv√©(e) ?"],
      ["Futur","Planifiez-vous beaucoup ce que vous allez faire dans les semaines √† venir ?"],
      ["Futur","Pensez-vous souvent √† ce que vous voulez devenir ?"],
      ["Futur","Anticipez-vous les cons√©quences futures de vos d√©cisions ?"],
      // Olfactif/Gustatif
      ["Olfactif","Les odeurs influencent-elles facilement votre humeur ?"],
      ["Olfactif","√ätes-vous tr√®s sensible aux parfums ou aux odeurs fortes ?"],
      ["Olfactif","Vous rappelez-vous facilement d‚Äôune personne gr√¢ce √† son odeur ?"],
      ["Olfactif","Avez-vous des odeurs pr√©f√©r√©es qui vous apaisent ou vous stimulent ?"],
      ["Olfactif","Une odeur peut-elle suffire √† vous rappeler un souvenir ?"],
      ["Gustatif","Le go√ªt influence-t-il fortement votre exp√©rience d‚Äôun moment ?"],
      ["Gustatif","Choisissez-vous des lieux ou √©v√©nements selon ce que vous allez y manger ?"],
      ["Gustatif","Vous arrive-t-il de manger juste pour le plaisir du go√ªt, sans faim ?"],
      ["Gustatif","Un bon plat peut-il am√©liorer votre humeur ?"],
      ["Gustatif","Le partage de repas est-il un moment important pour vous ?"],
      // Orientation
      ["Tourn√© vers soi","Pensez-vous d‚Äôabord √† vous avant d‚Äôaider les autres ?"],
      ["Tourn√© vers soi","Votre propre bien-√™tre passe-t-il en priorit√© dans vos d√©cisions ?"],
      ["Tourn√© vers soi","Avez-vous besoin d‚Äô√™tre align√©(e) avec vous-m√™me avant d‚Äôagir ?"],
      ["Tourn√© vers soi","Votre confort personnel est-il une condition essentielle √† votre implication ?"],
      ["Tourn√© vers soi","Faites-vous passer vos besoins en premier dans un groupe ?"],
      ["Tourn√© vers les autres","Anticipez-vous souvent les besoins ou attentes des autres ?"],
      ["Tourn√© vers les autres","Vos choix sont-ils souvent guid√©s par le plaisir que cela procurera aux autres ?"],
      ["Tourn√© vers les autres","Pr√©f√©rez-vous faire plaisir quitte √† vous contraindre un peu ?"],
      ["Tourn√© vers les autres","Vous sentez-vous responsable du bien-√™tre des autres ?"],
      ["Tourn√© vers les autres","Est-il important pour vous d‚Äô√™tre per√ßu(e) comme quelqu‚Äôun d‚Äôattentionn√© ?"],
      // Focus
      ["Global","Aimez-vous comprendre les grandes lignes avant d‚Äôentrer dans les d√©tails ?"],
      ["Global","Pr√©f√©rez-vous les visions d‚Äôensemble aux explications minutieuses ?"],
      ["Global","Avez-vous besoin de situer les choses dans un cadre g√©n√©ral ?"],
      ["Global","Est-ce que les d√©tails vous int√©ressent surtout une fois la vue d‚Äôensemble comprise ?"],
      ["Global","Avez-vous du mal √† rester concentr√©(e) sur des choses trop pr√©cises ?"],
      ["D√©tail","Aimez-vous d√©cortiquer les choses en √©l√©ments pr√©cis ?"],
      ["D√©tail","Sur un mur nouvellement peint, allez-vous voir instantan√©ment le petit d√©tail mal fait ?"],
      ["D√©tail","Vous attachez-vous aux d√©tails avant d‚Äôembrasser une vision globale ?"],
      ["D√©tail","Les choses inexactes ou floues vous mettent-elles mal √† l‚Äôaise ?"],
      ["D√©tail","Vous sentez-vous rassur√©(e) par des donn√©es pr√©cises ?"],
      // √ânergie
      ["Introverti","Avez-vous besoin de calme pour vous ressourcer ?"],
      ["Introverti","Pr√©f√©rez-vous les interactions en petit comit√© ?"],
      ["Introverti","Le temps seul(e) est-il vital pour votre √©quilibre ?"],
      ["Introverti","Trouvez-vous fatigantes les r√©unions sociales prolong√©es ?"],
      ["Introverti","Vous sentez-vous plus vous-m√™me dans l‚Äôintimit√© que dans un groupe ?"],
      ["Extraverti","Vous sentez-vous √©nergis√©(e) par la pr√©sence des autres ?"],
      ["Extraverti","Avez-vous tendance √† parler pour r√©fl√©chir ?"],
      ["Extraverti","Cherchez-vous la compagnie plut√¥t que la solitude ?"],
      ["Extraverti","Les environnements dynamiques vous stimulent-ils ?"],
      ["Extraverti","Pr√©f√©rez-vous partager vos pens√©es plut√¥t que les garder pour vous ?"]
    ];

    // Mapping PAN to Metaprogramme (invisible logic)
    const panToMeta = {
      "Visuel": "VAKOG", "Auditif": "VAKOG", "Kinesth√©sique": "VAKOG", "Olfactif": "VAKOG", "Gustatif": "VAKOG",
      "Proc√©dure": "Proc√©dure/Option", "Option": "Proc√©dure/Option",
      "Proactif": "Proactif/R√©actif", "R√©actif": "Proactif/R√©actif",
      "Pass√©": "Rapport au temps", "Pr√©sent": "Rapport au temps", "Futur": "Rapport au temps",
      "Pouvoir": "Motivation", "Objectif": "Motivation", "Affiliation": "Motivation",
      "Tourn√© vers soi": "Orientation", "Tourn√© vers les autres": "Orientation",
      "Introverti": "√ânergie", "Extraverti": "√ânergie",
      "D√©tail": "Focus", "Global": "Focus"
    };

    // For result placeholders (order: as in demo)
    const metaprogrammePans = {
      "Proc√©dure/Option":["Proc√©dure","Option"],
      "Motivation":["Pouvoir","Objectif","Affiliation"],
      "√ânergie":["Introverti","Extraverti"],
      "Proactif/R√©actif": ["Proactif","R√©actif"],
      "Rapport au temps": ["Pass√©","Pr√©sent","Futur"],
      "Orientation": ["Tourn√© vers soi","Tourn√© vers les autres"],
      "VAKOG": ["Visuel","Auditif","Kinesth√©sique","Olfactif","Gustatif"],
      "Focus": ["D√©tail","Global"]
    };

    // Interpretation templates (FR, warm)
    const interpretationTemplates = {
      "Motivation": {
        "Pouvoir": "Deux Pouvoir √©lev√©s ‚Üí couple explosif. √âquilibre si Pouvoir avec Objectif ou Affiliation.",
        "Objectif": "Compatibilit√© forte avec Affiliation. Un Objectif dominant temp√®re un Pouvoir.",
        "Affiliation": "Id√©al avec Objectif. Risque de d√©pendance si deux Affiliation √©lev√©s."
      },
      "Proactif_R√©actif": {
        "Proactif": "Deux Proactifs ‚Üí passion et vitesse, mais risque de pr√©cipitation.",
        "R√©actif": "Deux R√©actifs ‚Üí s√©curit√© et stabilit√©, mais inertie possible.",
        "Mix": "√âquilibre entre action et r√©flexion."
      },
      "Option_Proc√©dure": {
        "Proc√©dure": "Deux Proc√©dure ‚Üí rigueur et organisation, mais rigidit√©.",
        "Option": "Deux Option ‚Üí libert√© et cr√©ativit√©, mais instabilit√©.",
        "Mix": "√âquilibre entre structure et cr√©ativit√©."
      },
      "Rapport_Temps": {
        "Pass√©_Futur": "Pass√© dominant vs Futur dominant ‚Üí incompr√©hensions (m√©moire vs projection).",
        "Pr√©sent": "Deux Pr√©sents ‚Üí intensit√© dans l‚Äôinstant, mais insouciance possible.",
        "Mix": "Harmonie si un partenaire vit dans le pr√©sent et l‚Äôautre dans le futur (vision) ou pass√© (stabilit√©)."
      },
      "√ânergie": {
        "Introverti": "Deux Introvertis ‚Üí compr√©hension silencieuse et paisible.",
        "Extraverti": "Deux Extravertis ‚Üí complicit√© √©nergique.",
        "Mix": "Si un 60%+ Introverti vs un 60%+ Extraverti ‚Üí tensions et incompr√©hensions."
      }
    };

    // Example long-form interpretation (used for segmentation)
    const exampleSegments = [
      "¬´ Votre profil amoureux r√©v√®le une √©nergie singuli√®re. Si la Motivation Pouvoir domine, vous √™tes attir√©(e) par l‚Äôinfluence et l‚Äôaffirmation de soi, ce qui peut s√©duire mais aussi g√©n√©rer des tensions si votre partenaire partage la m√™me intensit√©. L‚Äô√©quilibre na√Æt lorsque Pouvoir rencontre Objectif ou Affiliation, car l‚Äôun apporte direction et l‚Äôautre connexion. Un Objectif dominant offre clart√© et progression, id√©alement compl√©t√© par une Affiliation chaleureuse qui renforce la complicit√©. ¬ª",
      "¬´ Votre dynamique Proactif / R√©actif fa√ßonne votre rythme amoureux. Deux Proactifs cr√©ent une relation passionn√©e et stimulante, mais peuvent parfois foncer t√™te baiss√©e. Deux R√©actifs privil√©gient la s√©curit√© et la stabilit√©, au risque de manquer d‚Äô√©lan. La combinaison des deux offre souvent le meilleur √©quilibre : l‚Äôun initie, l‚Äôautre temp√®re. Votre couple trouve ainsi une cadence naturelle entre action et r√©flexion, gage de long√©vit√© et d‚Äôharmonie. ¬ª",
      "¬´ Le duo Proc√©dure / Option refl√®te votre rapport aux r√®gles et √† la cr√©ativit√©. Deux profils Proc√©dure partagent une rigueur rassurante, mais peuvent s‚Äôenfermer dans la routine. Deux Option vivent l‚Äôinstant, cultivant la libert√©, mais risquent l‚Äôinstabilit√©. Un couple mixte allie solidit√© et spontan√©it√©, permettant d‚Äô√©voluer dans un cadre souple. Si vous √™tes majoritairement Option, cherchez un(e) partenaire qui saura canaliser vos √©lans sans brider votre inspiration. ¬ª",
      "¬´ Enfin, votre rapport au Temps et √† l‚Äô√ânergie influence la compatibilit√©. Deux Pr√©sents vivent une intensit√© gris√©e, mais peuvent manquer de projection. Le Pass√© s‚Äôattache aux racines, le Futur b√¢tit des projets : ces visions diff√©rentes n√©cessitent dialogue pour s‚Äôharmoniser. C√¥t√© √ânergie, deux Introvertis s‚Äôaccordent dans une bulle intime, deux Extravertis partagent une complicit√© vive. Les √©carts trop marqu√©s (60%+ Introverti vs 60%+ Extraverti) exigent plus d‚Äôefforts de compr√©hension. ¬ª"
    ];

    // --- STATE ---
    let currentQ = 0;
    let answers = []; // {pan, value}
    let selected = null;

    // --- Shuffle questions on session start ---
    function shuffleArray(arr) {
      // Fisher-Yates shuffle
      let a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    // Use local variable so the order is fixed for one session/visit
    const questions = shuffleArray(questionsRaw);

    // --- DOM ELEMENTS ---
    const qCard = document.getElementById('question-card');
    const qNumber = document.getElementById('question-number');
    const qText = document.getElementById('question-text');
    const answerBtns = Array.from(document.getElementsByClassName('answer-btn'));
    const nextBtn = document.getElementById('next-btn');
    const alertBox = document.getElementById('alert');
    const progressBar = document.getElementById('progress-bar');

    // Result block
    const resultBlock = document.getElementById('result-block');
    const emailInput = document.getElementById('email');
    const consentBox = document.getElementById('consent');
    const emailDupMsg = document.getElementById('email-duplicate-msg');
    const successMsg = document.getElementById('success-msg');

    // --- LOGIC ---

    function showQuestion(idx) {
      // Fade out
      qCard.classList.add('question-fade');
      setTimeout(()=>{
        // Set question
        qNumber.textContent = (idx+1) + ".";
        qText.textContent = questions[idx][1];
        answerBtns.forEach(btn => btn.classList.remove('selected'));
        selected = null;
        alertBox.classList.remove('show-alert');
        // Fade in
        qCard.classList.remove('question-fade');
        // Progress bar
        progressBar.style.width = ((idx/105)*100).toFixed(2) + "%";
      }, 210);
    }

    answerBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        answerBtns.forEach(b=>b.classList.remove('selected'));
        this.classList.add('selected');
        selected = parseInt(this.dataset.value);
        alertBox.classList.remove('show-alert');
      });
    });

    nextBtn.addEventListener('click', function() {
      if(selected === null){
        alertBox.classList.add('show-alert');
        return;
      }
      // Save answer
      answers[currentQ] = { pan: questions[currentQ][0], value: selected };
      // Next
      currentQ++;
      if(currentQ < questions.length){
        showQuestion(currentQ);
      }else{
        // End: show results block
        qCard.classList.add('question-fade');
        setTimeout(()=>{
          qCard.style.display = 'none';
          resultBlock.style.display = 'flex';
          progressBar.style.width = "100%";
          window.scrollTo({top:0,behavior:'smooth'});
        },300);
      }
    });

    // --- INITIALIZE ---
    showQuestion(0);

    // --- Results & Normalization ---
    function computeResults() {
      // Compute raw totals per pan
      const panTotals = {};
      const panCounts = {};
      answers.forEach(({pan,value})=>{
        panTotals[pan] = (panTotals[pan]||0) + value;
        panCounts[pan] = (panCounts[pan]||0) + 1;
      });
      // For each metaprogramme, normalize so its pans sum = 100%
      const metaScores = {};
      Object.keys(metaprogrammePans).forEach(meta=>{
        const pans = metaprogrammePans[meta];
        let total = 0;
        let panRaw = pans.map(p=>panTotals[p]||0);
        total = panRaw.reduce((a,b)=>a+b,0);
        // Normalize
        metaScores[meta] = {};
        pans.forEach((p,i)=>{
          let norm = total>0 ? Math.round(100*panRaw[i]/total) : 0;
          metaScores[meta][p] = norm;
        });
      });
      return metaScores;
    }

    // --- Results Serialization (for webhook) ---
    function buildPayload(email, captchaToken) {
      const scores = computeResults();
      return {
        bonus_id: "tome1",
        response: captchaToken,
        email,
        // Placeholders for all metaprogrammes
        "proc√©dure_score": scores["Proc√©dure/Option"]["Proc√©dure"],
        "option_score": scores["Proc√©dure/Option"]["Option"],
        "pouvoir_score": scores["Motivation"]["Pouvoir"],
        "objectif_score": scores["Motivation"]["Objectif"],
        "affiliation_score": scores["Motivation"]["Affiliation"],
        "introverti_score": scores["√ânergie"]["Introverti"],
        "extraverti_score": scores["√ânergie"]["Extraverti"],
        "proactif_score": scores["Proactif/R√©actif"]["Proactif"],
        "r√©actif_score": scores["Proactif/R√©actif"]["R√©actif"],
        "pass√©_score": scores["Rapport au temps"]["Pass√©"],
        "pr√©sent_score": scores["Rapport au temps"]["Pr√©sent"],
        "futur_score": scores["Rapport au temps"]["Futur"],
        "vers_soi_score": scores["Orientation"]["Tourn√© vers soi"],
        "vers_autres_score": scores["Orientation"]["Tourn√© vers les autres"],
        "visuel_score": scores["VAKOG"]["Visuel"],
        "auditif_score": scores["VAKOG"]["Auditif"],
        "kinesth√©sique_score": scores["VAKOG"]["Kinesth√©sique"],
        "olfactif_score": scores["VAKOG"]["Olfactif"],
        "gustatif_score": scores["VAKOG"]["Gustatif"],
        "d√©tail_score": scores["Focus"]["D√©tail"],
        "global_score": scores["Focus"]["Global"],
        // Add interpretation segments placeholder (for email)
        "segments_part1": buildInterpretationSegments(scores,0),
        "segments_part2": buildInterpretationSegments(scores,1),
        "segments_part3": buildInterpretationSegments(scores,2),
        "segments_part4": buildInterpretationSegments(scores,3)
      };
    }

    // --- Interpretation logic (only 5 key metaprogrammes) ---
    function buildInterpretationSegments(scores, partIdx){
      // Use example segments for now, or can be customized below.
      // You can extend here by analyzing the scores to personalize the segment.
      return exampleSegments[partIdx];
    }

    // --- Form Submission & reCAPTCHA Logic ---
    let lastCaptchaToken = "";
    window.onSubmit = function(token){
      lastCaptchaToken = token;
    };

    resultBlock.addEventListener('submit', function(e){
      e.preventDefault();
      emailDupMsg.style.display = 'none';
      successMsg.style.display = 'none';

      // Validate
      const email = emailInput.value.trim();
      if(!email || !consentBox.checked){
        if(!email) emailInput.focus();
        return;
      }
      // Validate captcha
      if(!lastCaptchaToken){
        alert("Captcha invalide. Merci de r√©essayer.");
        return;
      }

      // Build payload
      const payload = buildPayload(email, lastCaptchaToken);

      // POST
      fetch("https://hook.eu2.make.com/nq8suncrqqr7vqvothftezfygqrufqh2",{
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      })
      .then(r => r.text())
      .then(responseText => {
        if(responseText.includes("duplicate")){
          emailDupMsg.textContent = "‚ö†Ô∏è Cette adresse e-mail a d√©j√† servi pour un test üí°. Merci d‚Äôen indiquer une autre afin de recevoir une nouvelle interpr√©tation.";
          emailDupMsg.style.display = 'block';
        }else if(responseText.includes("captcha_failed")){
          alert("Captcha invalide. Merci de r√©essayer.");
        }else{
          // Success
          resultBlock.querySelectorAll('input,button,.g-recaptcha').forEach(el=>el.style.display='none');
          successMsg.textContent = "Merci ‚ù§Ô∏è Votre analyse personnalis√©e a √©t√© envoy√©e √† " + email + ".";
          successMsg.style.display = 'block';
        }
      })
      .catch(()=>{
        alert("Erreur r√©seau. Veuillez r√©essayer dans quelques instants.");
      });
    });

    // --- UX: Enter press selects next ---
    document.addEventListener('keydown', function(e){
      if(qCard.style.display!=='none' && (e.key==="Enter" || e.keyCode===13)){
        if(selected!==null){
          nextBtn.click();
          e.preventDefault();
        }
      }
    });

    // --- Prevent form submit on Enter in email field ---
    emailInput.addEventListener('keydown', function(e){
      if(e.key === "Enter") e.preventDefault();
    });

    // --- Reset duplicate message on input change ---
    emailInput.addEventListener('input',()=>{emailDupMsg.style.display='none';});

    // --- Smooth scroll to top on mobile at results ---
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // --- Hide result block on reload ---
    window.addEventListener('pageshow', function(){
      resultBlock.style.display = 'none';
      qCard.style.display = '';
      currentQ = 0;
      answers = [];
      showQuestion(0);
      progressBar.style.width = "0%";
    });
  </script>
</body>
</html>
