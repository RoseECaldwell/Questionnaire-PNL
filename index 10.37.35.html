
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>üíñ Test MetaLove</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Helvetica Neue', sans-serif;
      background: linear-gradient(to bottom, #fff0f5, #ffe4e1);
      padding: 2rem;
      color: #333;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      color: #e75480;
      margin-bottom: 2rem;
    }
    .question {
      margin-bottom: 1.5rem;
      background: white;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .question p {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .answers label {
      display: block;
      margin: 3px 0;
      cursor: pointer;
    }
    .email-block {
      margin-top: 2rem;
      text-align: center;
    }
    input[type="email"], button {
      padding: 0.8rem;
      font-size: 1rem;
      margin-top: 1rem;
      width: 100%;
      max-width: 400px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #e75480;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #d64570;
    }
  </style>
</head>
<body>
  <h1>üíñ Test MetaLove</h1>
  <form id="test-form"></form>

  <div class="email-block">
    <input type="email" id="email-input" placeholder="Votre adresse email" required />
    <button type="submit" id="submit-btn">Envoyer mes r√©sultats</button>
    <p id="already-used-msg" style="color:red; display:none;">Cette adresse a d√©j√† √©t√© utilis√©e.</p>
  </div>

  <script>
    const form = document.getElementById('test-form');
    const submitBtn = document.getElementById('submit-btn');
    const emailInput = document.getElementById('email-input');
    const message = document.getElementById('already-used-msg');

    const responses = ['Oui', 'Souvent', 'Rarement', 'Non'];
    const weights = [100, 50, 25, 0];

    let questions = [];

    fetch('questions_bonus_105_final.csv')
      .then(res => res.text())
      .then(data => {
        questions = data.trim().split('\n').map(row => row.split(';')[1]);
        questions.forEach((text, i) => {
          const div = document.createElement('div');
          div.className = 'question';
          div.innerHTML = `
            <p>${i + 1}. ${text}</p>
            <div class="answers">
              ${responses.map((resp, idx) =>
                `<label><input type="radio" name="q${i}" value="${weights[idx]}" required> ${resp}</label>`
              ).join('')}
            </div>
          `;
          form.appendChild(div);
        });
      });

    submitBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      const email = emailInput.value.trim().toLowerCase();
      if (!email) return;

      const radios = document.querySelectorAll('input[type="radio"]:checked');
      if (radios.length !== questions.length) {
        alert("Veuillez r√©pondre √† toutes les questions.");
        return;
      }

      // (Optionnel) Check si l'email est d√©j√† utilis√© via une API ou base (√† impl√©menter c√¥t√© serveur ou Make)
      // Simul√© ici : message.style.display = 'block';

      const answers = [...radios].map(r => parseInt(r.value));
      const scoreGlobal = Math.round(answers.reduce((a, b) => a + b, 0) / answers.length);

      const payload = {
        email,
        global_score: scoreGlobal,
        interpretation_text: "",
        bonus: "tome1"
      };

      fetch("https://hook.eu2.make.com/...", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      alert("Merci ! Votre profil vous sera envoy√© par email.");
    });
  </script>
</body>
</html>
